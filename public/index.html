<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyBank</title>
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="blur-overlay" id="auth-overlay">
  <div class="login-box">
    <h2>Log in MyBank</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button type="button" id="login-btn">Login</button>
    <div id="login-error"></div>
  </div>
</div>

<button id="logout-btn" class="logout-button">Logout</button>
<div class="welcome-message" id="welcome-msg">
  Welcome to <strong>MyBank</strong>!
</div>

<div class="account-info">
  <h1 id="bank-name">Bank: MyBank</h1>
  <p id="owner-name">Owner: Oleksandr R.</p>
  <p id="country">Country: Poland</p>
  <h2 id="balance" class="positive">Balance: +$78160.00</h2>
</div>

<div class="time-widget-container">
  <span id="local-time">--:--:--</span>
</div>

<div class="main-content">
  <h3>Transaction History</h3>
  <div class="table-wrapper" style="margin-top: 0;">
    <table id="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Time</th>
          <th>Location</th>
        </tr>
      </thead>
  <tbody id="expenses-body"></tbody>
    </table>
  </div>
</div>

<script>
  function updateTime() {
    const now = new Date();
    const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'Europe/Warsaw' };
    const timeString = now.toLocaleTimeString('pl-PL', options);
    document.getElementById('local-time').textContent = timeString;
  }
  setInterval(updateTime, 1000);
  updateTime(); // запуск сразу
</script>

<div class="weather-widget-container">
  <div id="ww_884413e1124f1" v='1.3' loc='id' a='{
    "t":"horizontal",
    "lang":"en",
    "sl_lpl":1,
    "ids":["wl1709"],
    "font":"Arial",
    "sl_ics":"one_a",
    "sl_sot":"celsius",
    "cl_bkg":"image",
    "cl_font":"#FFFFFF",
    "cl_cloud":"#FFFFFF",
    "cl_persp":"#81D4FA",
    "cl_sun":"#FFC107",
    "cl_moon":"#FFC107",
    "cl_thund":"#FF5722"
  }'>
    More forecasts:
    <a href="https://oneweather.org/warsaw/30_days/" id="ww_884413e1124f1_u" target="_blank" rel="noopener">Weather forecast Warsaw 30 days</a>
  </div>
  <script async src="https://app3.weatherwidget.org/js/?id=ww_884413e1124f1"></script>
</div>

<div class="currency-widget-container">
  <script>
    var fm = "PLN";
    var to = "EUR,USD,RUB,CNY";
    var tz = "timezone";
    var sz = "1x238";
    var lg = "en";
    var st = "primary";
    var cd = 0;
    var am = 100;
  </script>
  <script src="https://currencyrate.today/exchangerates"></script>
  <div class="currency-link-container">
    <a href="https://currencyrate.today" target="_blank" rel="noopener">CurrencyRate</a>
  </div>
</div>

<script src="main.js" defer></script>
<script src="login.js" defer></script>
<script>
  // Привязка login к кнопке через JS
  document.getElementById('login-btn').addEventListener('click', async () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const errorEl = document.getElementById('login-error');

    if (errorEl) { errorEl.style.display = 'none'; errorEl.textContent = ''; }
    if (!email || !password) {
      if (errorEl) { errorEl.textContent = 'Enter email and password'; errorEl.style.display = 'block'; }
      return;
    }

    try {
      const response = await fetch('https://mybank-8s6n.onrender.com/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await response.json();

      if (response.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('isLoggedIn', 'true');
        document.getElementById('auth-overlay').style.display = 'none';
        if (typeof loadExpenses === 'function') loadExpenses();
      } else {
        if (errorEl) { errorEl.textContent = data.message || 'Login failed'; errorEl.style.display = 'block'; }
      }
    } catch (err) {
      if (errorEl) { errorEl.textContent = 'Network error'; errorEl.style.display = 'block'; }
    }
  });
</script>
</script>

  <!-- Footer: repository and LinkedIn links -->
  <footer class="site-footer" style="padding:16px 20px; text-align:center; font-size:0.95rem; color:var(--muted-color,#666);">
    <div class="footer-inner">
      <span>Repository: <a href="https://github.com/alexDjs/MyBank" target="_blank" rel="noopener">MyBank on GitHub</a></span>
      <span style="margin:0 8px;">&middot;</span>
      <span>LinkedIn: <a href="https://www.linkedin.com/in/oleksandr-shchehlov/" target="_blank" rel="noopener">Oleksandr Shchehlov</a></span>
    </div>
  </footer>

</body>
</html>
